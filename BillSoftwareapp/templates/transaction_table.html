{% extends 'base.html' %}
{% block content %}
{% load static %}



<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>



<!-- Include jQuery.table2excel plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>

<!-- Include jQuery from a CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<!-- Include jsPDF-AutoTable plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.16/jspdf.plugin.autotable.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- Add these links to include the required libraries -->
<script src="https://rawgit.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="https://rawgit.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha384-**********" crossorigin="anonymous">




<style>
    body{
        background-color: rgb(130, 144, 199);
        
    }
    td{
        padding: 5px 10px;
        font-size: larger;
        
    }
    td a{
        text-decoration: none;
    }
    #thirdTable label,#thirdTable span,#detailsTable td{
        color: black;
    }
    #partyTable th{
        color: black;
        font-size: large;
    }
    .search-results li {
      padding: 8px;
      cursor: pointer;
    }

    .search-results li:hover {
      background-color: #f0f0f0;
    }
    #myInput1{
        box-shadow: 1px 1px  gray;
        
    }
    #myInput1:hover{
        box-shadow: none;
    }
    #detailsTable th{
        color: black;
        font-size: larger;
    }
    #editt{
        color: rgb(58, 15, 214);
        /* display: inline-flex; */
        padding: 0;

    }
    #editt:hover{
        color: rgb(9, 62, 186);
    }
    #filterDropDown a{
        color: black;
    }


  #partyTableScroll::-webkit-scrollbar {
    width: 1px;
    height: 0px;
  }

  #partyTableScroll::-webkit-scrollbar-track {
    background-color: #f1f1f1;
  }

  #partyTableScroll::-webkit-scrollbar-thumb {
    background-color: #888;
    border-radius: 10px;
    width: 2px;
    
  }

  #partyTableScroll::-webkit-scrollbar-thumb:hover {
    background-color: #555;
    width: 2px;
  }

  /* For Firefox */
  #partyTableScroll {
    scrollbar-width: 2px;
    scrollbar-color: #888 #f1f1f1;
  }

  /* For IE/Edge */
  #partyTableScroll {
    -ms-overflow-style: none;
    scrollbar-width: 2px;
    scrollbar-color: #888 #f1f1f1;
  }

  /* Hide the scrollbar in Firefox and IE/Edge */
  #partyTableScroll {
    overflow: auto;
  }

</style>

<div class="container col-md-10 mr-1" style="background-color: rgb(130, 144, 199);min-height: 100vh;"><br><br><br><br><br><br>
    
    <div class="col-11 container mr-1">
        <div>
            <!-- Export to Excel button -->
            <i class="fas fa-file-excel" style="cursor: pointer; color: green; font-size: 30px;" onclick="exportToExcel()" title="Export to Excel"></i>
            <p style='color:black;'>Excel</p>
        </div>
        <div>
            <!-- Print button -->
            <button class="btn btn-primary ml-1" onclick="printTable()">
                <i class="fa-solid fa-print"></i>
            </button>
            <p style='color:black;'>Print</p>
        </div>


        <div class="row">
            

            <div class="col-11 table-responsive" style="background-color: white;padding: 30px;border-radius: 15px;box-shadow: 3px 3px 3px gray;">
                
                <div class="row">
                    
                        <h3>All Credit Note </h3> <div>
                            
                          </div> 
                    


                    
                        <!-- ===================-search bar-=============================== -->

                    <div class="search-bar ml-auto w-40" ><br>
                        <div class="input-group" >
                          
                          <input type="text" autocomplete="off" id="myInput1" onkeyup="filter(this);" onclick="myFunction1()" class="form-control" placeholder="search"  />
                          
                          <a href="{% url 'credit_add' %}" style="background-color: #3d4465;color: white;" onmouseover="this.style.backgroundColor='#480ceb'" onmouseout="this.style.backgroundColor='#3d4465'" class="btn ml-2" >Add new credit note  <i class="fa-solid fa-plus"></i></a>

                          
                        </div>
                      </div>

                    <!-- ====================================================== -->
                   
                    
                </div>
                <br>
                      
            
                      
                      
                      

                    <!-- party table  -->
                    <!-- style="max-height: 50vh;overflow-y: scroll;" id="partyTableScroll" -->
                <div class="row"  >
                    
                    <table class="table " id="partyTable" >
                        
                        <thead>
                            <th class="">Sl.No</th>
                            <th class="">DATE <i class="fa-solid fa-filter"></i></th>
                            <th class="">REF.NO <i class="fa-solid fa-filter"></i></th>
                            <th class="">PARTY NAME <i class="fa-solid fa-filter"></i></th>
                            <th class="">TYPE <i class="fa-solid fa-filter"></i></th>
                            <th class="">TOTAL<i class="fa-solid fa-filter"></i></th>
                            <th class=""></th>
                            
                        </thead>
                    </table>
                
                </div>
               
        </div>
    </div><br><br>
            
    
            <br><br><br>

    </div>
</div>

<script>





// -----------------------------------------------------------------------------------------------------------------

// filter table -- 


// function filterPartyRows(partyName, phoneNumber,totalAmount) {
//     // Show/hide rows in the second table based on the selected party name
//     var partyRows = document.querySelectorAll('.party-row');
//     var index = 1; // Initialize the index

//     partyRows.forEach(function (row) {
//         var rowPartyName = row.querySelector('td:nth-child(2)').textContent.trim();
//         var rowMobileNumber = row.querySelector('td:nth-child(4)').textContent.trim();

//         // Check if both party name and mobile number match the selected value
//         var shouldShowRow = rowPartyName === partyName && rowMobileNumber === phoneNumber;
//         row.style.display = shouldShowRow ? '' : 'none';

//         if (shouldShowRow) {
//             // Update the content in the first column with the index
//             row.querySelector('td:first-child').textContent = index++;

//             // Get details from the second table row
//             // var number = row.querySelector('#detailsTable td:nth-child(2)').textContent.trim();
//             var email = row.querySelector('#detailsTable td:nth-child(9)').textContent.trim();
//             var address = row.querySelector('#detailsTable td:nth-child(10)').textContent.trim();
//             var gstin = row.querySelector('#detailsTable td:nth-child(11)').textContent.trim();
            

//             // Update the content in the third table
//             document.getElementById('namee').innerHTML = partyName.toUpperCase();
//             document.querySelector('#number').textContent = phoneNumber;

//             // Check if address is empty
//             if (address.trim() === '') {
//                 // Display link & icon
//                 document.querySelector('#address').innerHTML = "<a href=''><i class='fa-solid fa-location-dot'></i> No Address</a>";
//             } else {
//                 // Display address
//                 document.querySelector('#address').textContent = address;
//             }

//             // Check if GSTIN is empty
//             if (gstin.trim() === '') {
//                 // Display link & icon
//                 document.querySelector('#gstin').innerHTML = '<a href=""><i class="fa-solid fa-calculator"></i> No GSTIN</a>';
//             } else {
//                 // Display GSTIN
//                 document.querySelector('#gstin').textContent = gstin;
//             }

//             // Check if email is empty
//             if (email.trim() === '') {
//                 // Display link with envelope icon
//                 document.querySelector('#email').innerHTML = '<a href=""><i class="fa-solid fa-envelope"></i> No Email</a>';
//             } else {
//                 // Display email
//                 document.querySelector('#email').textContent = email;
//             }
//             document.querySelector('#balance').textContent = totalAmount;
           
//         }
//     });
// }



// ---------------------------------------------------------------
// party search function -----------------------------

                function filter(input) {
                                var filterValue = input.value.toLowerCase();
                                var tableRows = document.querySelectorAll('#partyTable tbody tr');

                                tableRows.forEach(function(row) {
                                var cells = row.querySelectorAll('#filterByName');
                                var isVisible = false;

                                for (var i = 0; i < cells.length; i++) {
                                    var cellValue = cells[i].textContent || cells[i].innerText;
                                    if (cellValue.toLowerCase().indexOf(filterValue) > -1) {
                                    isVisible = true;
                                    break;
                                    }
                                }

                                if (isVisible) {
                                    row.style.display = "table-row";
                                } else {
                                    row.style.display = "none";
                                }
                                });
                            }


// -------------------------------------------------------------
// filter for pay and receive

function filterTableForPartyBalance(filTer) {
                        table = document.getElementById("partyTable");
                        tr = table.getElementsByTagName("tr");
                            
                        for (i = 0; i < tr.length; i++) {
                            
                            td = tr[i].getElementsByTagName("td")[1]; // Change the index to match the column you want to filter
                            if (td) {
                                txtValue = td.textContent || td.innerText;
                                if (filTer === 'all' || (filTer === 'pay' && txtValue.toUpperCase() === 'PAY') || (filTer === 'receive' && txtValue.toUpperCase() === 'RECEIVE')) {
                                    tr[i].style.display = "";
                                } else {
                                    tr[i].style.display = "none";
                                }
                                }
                            }
                        }


{% comment %} excell export {% endcomment %}

function exportToExcel() {
    const table = document.getElementById("partyTable");
    const wb = XLSX.utils.table_to_book(table, { sheet: "CreditNotes" });
    XLSX.writeFile(wb, "credit_notes.xlsx");
}

{% comment %} print option {% endcomment %}
function printTable() {
    // Open the print dialog
    window.print();
}

</script>



{% endblock %}