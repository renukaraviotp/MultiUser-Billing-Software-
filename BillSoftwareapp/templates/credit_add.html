{% extends 'base.html' %}
{% block content %}
{% load static %}
<head>
    <script src="https://kit.fontawesome.com/fbe819dd43.js" crossorigin="anonymous"></script>
    <!-- Add these in the head section of your HTML -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
  

</head>
<style>
    #input,select,textarea{
        box-shadow: 2px 2px 2px gray;
    }
    #input:hover{
        box-shadow: none;
    }
    #bno,#bdt,#ad,#ph,#ip,#dt{
        box-shadow: 2px 2px 2px gray;
    }
    #bno:hover{
        box-shadow: none;
    }
    #bdt:hover{
        box-shadow: none;
    }
    #ad:hover{
        box-shadow: none;
    }
    #ph:hover{
        box-shadow: none;
    }
    #ip:hover{
        box-shadow: none;
    }
    #dt:hover{
        box-shadow: none;
    }
    #item_id:hover{
        box-shadow: none;
    }
    
    label{
        color: black;
    }
    body{
        background-color: rgb(130, 144, 199);
        
    }
    .party {
        margin: 20px;
      }
  
      .toggle-control {
        display: inline-block;
        position: relative;
        width: 60px;
        height: 34px;
      }
  
      .abc {
        opacity: 0;
        width: 0;
        height: 0;
      }
  
      .control {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        border-radius: 17px; /* Half of the height for rounded appearance */
        -webkit-transition: .4s;
        transition: .4s;
      }
  
      .control:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        border-radius: 50%; /* Rounded for the checkbox */
        -webkit-transition: .4s;
        transition: .4s;
      }
  
      .abc:checked + .control {
        background-color: #2196F3;
      }
  
      .abc:focus + .control {
        box-shadow: 0 0 1px #2196F3;
      }
  
      .abc:checked + .control:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
      }
      .search-box{
        width:100px;
        background:#fff;
        margin:200px auto 0;
        border-radius:5px;
      }
      th{
        color:black;
        font-weight:bold;
      }

      small {
        display: none; /* Ensures the text and input are on the same line */
        margin-right: 5px; /* Adjust the margin as needed */
    }

    #ab {
        border: none; /* Removes the border */
        outline: none; /* Removes the input focus border */
        background: transparent; /* Makes the input background transparent */
    }
        
      
      

</style>
<!-- Add this in the head section of your HTML -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>


<div class="container col-md-10 mr-1" style="background-color: rgb(130, 144, 199);min-height: 100vh;" >
    <br><br><br><br><br>    
    <form action="" class="col-10 container" method="get" enctype="multipart/form-data" style="background-color: white; padding: 30px; border-radius: 15px;box-shadow: 4px 3px 4px gray;">
        {% comment %} {% csrf_token %} {% endcomment %}
        <div class="container col-md-10">
            <h2>Add Credit Note</h2><br>
            {% for m in messages %}
            <h5 style="background-color: rgba(255, 0, 0, 0.4);color: red;font-size: larger;padding: 10px;border-radius: 10px;text-align: center;">{{m}}</h5>
            {% endfor %}

            <div class='party'>
                <h3>Party</h3>
                <label class="toggle-control">
                    <input class='abc' type="checkbox" name="abc" id="partyCheckbox" checked>
                    <span class="control"></span>
                </label>
            </div>
            <div id="partyForm" class="form-group row">
                    <div class="col-md-4 custom-dropdown">
                        <label for=""> Party Name</label>
                        <div class="input-group">
                            <input type="text" class="dropdown-input form-control" id="ip" placeholder='Search Party' oninput="getEmail();">
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#partyModal">
                                <i class="fa-solid fa-plus"></i>
                            </button>
                        </div>
<ul id="employee" class="dropdown-list">
    {% for p in party %}
        <li class="dropdown-item"
            data-value="{{ p.party_name }}"
            data-party-id="{{ p.id }}" data-phone="{{ p.phone_number }}" data-address="{{ p.billing_address }}" data-balance="{{ p.opening_balance }}"
            onclick="selectItem(this);"
        >
            {{ p.party_name }}
        </li>
    {% endfor %}
</ul>
                            
                            <small id="availableBalanceSection" style='color:black'>
                                
                                {% if party.to_pay == 1 %}
                                Available Balance:<input id="ab" style='color:red' type="text" readonly>
                                {% else %}
                                Available Balance:<input id="ab" style='color:green' type="text" readonly>
                                {% endif %}
                               
                            </small>
                    </div>
                    
                    <div class="col-md-4"><label for=""> Phone Number</label><input id="ph" type="text" name="number" class="form-control" pattern="[0-9]{10}" placeholder="Phone Number" readonly></div>
                    <div class="col-md-4"><label for="">Billing Address</label>
                        <textarea name="address" id="ad" cols="10" rows="4" class="form-control" placeholder="Billing Address..." readonly></textarea></div>
                
                </div>
            

            <div class="form-group row">
                <div class="col"><label for=""> Return No.</label><input id="input" type="number" value="" name="returnno" class="form-control" placeholder="Return Number" ></div>
                <div class="col"><label for=""> Bill No.</label><input id="bno" type="text" name="billNo" class="form-control" placeholder="Bill Number" ></div>
                <div class="col"><label for=""> Bill Date</label><input id="bdt" type="text" name="billDate" class="form-control" placeholder="Bill Date"> </div>
                
            </div>
        

            

            <div class="row form-group">
                <div class="col"><label for="">Date</label><input type="date" id="dt" name="date" value="{{todayDate}}" class="form-control"></div>

                <div class="col-md">
                    <label for="">State of Supply</label>
                        <select name="gsttype" class="form-control">
                            <option value="">--Select--</option>
                            <option value="state">State(GST)</option>
                            <option value="others">Others(IGST)</option>
                        </select>
                </div>
    
            </div>
        </div>
{% comment %} creditnote details script {% endcomment %}
    <script>
            document.getElementById('partyCheckbox').addEventListener('change', function() {
                var partyForm = document.getElementById('partyForm');
                partyForm.style.display = this.checked ? 'flex' : 'none';
            });
            document.addEventListener('DOMContentLoaded', function() {
                var dateInput = document.getElementsByName('date')[0];
                dateInput.value = ''; // Set the default value to an empty string
            });

            document.addEventListener('DOMContentLoaded', function () {
                var input = document.querySelector('.dropdown-input');
                var dropdownList = document.querySelector('#employee');
        
                input.addEventListener('focus', function () {
                    dropdownList.style.display = 'block';
                });
        
                document.addEventListener('mousedown', function (event) {
                    if (!event.target.closest('.custom-dropdown')) {
                        dropdownList.style.display = 'none';
                    }
                });
        
                dropdownList.addEventListener('click', function (event) {
                    if (event.target.classList.contains('dropdown-item')) {
                        input.value = event.target.textContent;
                        dropdownList.style.display = 'none';
                        fillEmployeeDetails();
                        clearErrorMessage();
                    }
                });
        
                input.addEventListener('input', function () {
                    var filterValue = input.value.toLowerCase();
                    var items = dropdownList.querySelectorAll('.dropdown-item');
        
                    items.forEach(function (item) {
                        var itemText = item.textContent.toLowerCase();
                        if (itemText.includes(filterValue)) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });

        // Function to fetch phone number and address based on selected party name



        function getEmail() {
            var selectedElement = document.querySelector(".dropdown-item.selected");
            
            if (selectedElement) {
                var phone_number = selectedElement.getAttribute("data-phone");
                var billing_address = selectedElement.getAttribute("data-address");
                var opening_balance = selectedElement.getAttribute("data-balance")
        
                // Assuming you have input fields with IDs "ph" and "ad" in your HTML
                document.getElementById("ph").value = phone_number;
                document.getElementById("ad").value = billing_address;
                document.getElementById("ab").value = opening_balance;
                

                // Show the Available Balance section
                document.getElementById("availableBalanceSection").style.display = "inline-block";

            }
        }
        
        document.addEventListener("DOMContentLoaded", function() {
            var dropdownItems = document.querySelectorAll(".dropdown-item");
        
            dropdownItems.forEach(function(item) {
                item.addEventListener("click", function() {
                    // Remove the "selected" class from all items
                    dropdownItems.forEach(function(dropdownItem) {
                        dropdownItem.classList.remove("selected");
                    });
        
                    // Add the "selected" class to the clicked item
                    item.classList.add("selected");
        
                    // Trigger the getEmail function
                    getEmail();
                });
            });
        });


        function selectItem(item) {
            var partyId = item.getAttribute("data-party-id");
    
            var url = "/get_sales_invoice_details/" + partyId;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Update the "Bill No." and "Bill Date" fields with fetched data
                    document.getElementById("bno").value = data.billNo;
                    document.getElementById("bdt").value = data.billDate;
                })
                .catch(error => console.error("Error fetching sales invoice details:", error));
        }


        document.addEventListener('DOMContentLoaded', function() {
            (function() {
              // Get the current date in the format YYYY-MM-DD
              const todayDate = new Date().toISOString().split('T')[0];
              
              // Set the value attribute of the input element with the ID "input"
              document.getElementById('dt').value = todayDate;
            })();
          });
            
    </script>
</form>
{% comment %} -----modal----- {% endcomment %}
<div class="modal fade" id="partyModal" tabindex="-1" role="dialog" aria-labelledby="partyModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="partyModalLabel">Add New Party</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Your form goes here -->
                    <form id="form_action" action="{% url 'party_save' %}" method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                
                        <div class="form-group row">
                            <div class="col"><label id="partyname"> Party Name:</label><input id="input" type="text" name="partyname" class="form-control" placeholder="Party Name" required></div>
                            <div class="col"><label id="mobilenumber"> Phone Number:</label><input id="input" type="text" name="mobilenumber" class="form-control" pattern="[0-9]{10}" placeholder="Phone Number" required></div>
                            <div class="col"><label for=""> GSTIN:</label><input id="input" type="text" name="gstin" class="form-control" placeholder="GSTIN" id="gstinInput" pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[0-9]{1}Z[0-9]{1}"> <small>#27ABCDE1234F1Z5</small></div>
                            
                        </div>
                
                        
                
                        <div class="row form-group">
                
                            <div class="col-md">
                                <label for="">GST Type:</label>
                                    <select name="gstintype" class="form-control">
                                        <option value="">--Select GST type--</option>
                                        <option value="Unregistered/Consumers">Unregistered/Consumers</option>
                                        <option value="Registered Buisness - Regular">Registered Buisness - Regular</option>
                                        <option value="Registered Buisness - Composition">Registered Buisness - Composition</option>
                                    </select>
                            </div>
                            <div class="col-md">
                                <label for="">State</label>
                                    <select name="state" class="form-control">
                                        <option value="">--Select State--</option>
                                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                                        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                        <option value="Assam">Assam</option>
                                        <option value="Bihar">Bihar</option>
                                        <option value="Chhattisgarh">Chhattisgarh</option>
                                        <option value="Goa">Goa</option>
                                        <option value="Gujarat">Gujarat</option>
                                        <option value="Haryana">Haryana</option>
                                        <option value="Himachal Pradesh">Himachal Pradesh</option>
                                        <option value="Jharkhand">Jharkhand</option>
                                        <option value="Karnataka">Karnataka</option>
                                        <option value="Kerala">Kerala</option>
                                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                                        <option value="Maharashtra">Maharashtra</option>
                                        <option value="Manipur">Manipur</option>
                                        <option value="Meghalaya">Meghalaya</option>
                                        <option value="Mizoram">`Mizoram</option>
                                        <option value="Nagaland">Nagaland</option>
                                        <option value="Odisha">Odisha</option>
                                        <option value="Punjab">Punjab</option>
                                        <option value="Rajasthan">Rajasthan</option>
                                        <option value="Sikkim">Sikkim</option>
                                        <option value="Tamil Nadu">Tamil Nadu</option>
                                        <option value="Telangana">Telangana</option>
                                        <option value="Tripura">Tripura</option>
                                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                                        <option value="Uttarakhand">Uttarakhand</option>
                                        <option value="West Bengal">West Bengal</option>
                                        
                                    </select>
                            </div>
                
                            <div class="col-md"><label for="">Email:</label><input id="input" type="email" name="email" class="form-control" placeholder="Email" ></div>
                            <div class="col-md"><label for="">Date</label><input id="input" type="date" name="date" class="form-control" value="{{todaydate}}"  ></div>
                 
                        </div><br>
                
                        <div class="row form-group">
                            <div class="col-md-6">
                                <label for="">Billing Address</label>
                                <textarea name="address" id="" cols="10" rows="4" class="form-control" placeholder="Billing Address..."></textarea>
                            </div>
                        </div>
                        <br>
                        <div class="row form-group">
                            <div class="col-md-4">
                                <label for="">Balance</label>
                                <input id="input" type="number" name="balance" class="form-control" placeholder="Balance" min="0">
                            </div>
                        </div>
                        <div class="row form-group radio-buttons ml-1" style="display: none;">
                            
                            <input type="radio" name="pay_recieve" class="col-1" value="pay"><label style="color: black;">To Pay</label>
                            <input type="radio" name="pay_recieve" class="col-1" value="receive"><label style="color: black;">To Receive</label>
                            
                        </div><br>
                
                        
                            <center>
                                {% comment %} <button id="checkk" style="background-color: #3d4465;color: white;" onmouseover="this.style.backgroundColor='#480ceb'" onmouseout="this.style.backgroundColor='#3d4465'" class="btn " value="new" name="buttonn">Save & New</button>  {% endcomment %}
                                <button style="background-color: #3d4465;color: white;" onmouseover="this.style.backgroundColor='#480ceb'" onmouseout="this.style.backgroundColor='#3d4465'" class="btn " value="old" name="buttonn">Save </button> 
                            </center>
                
                </form>
                </div>
            </div>
        </div>
</div>
                    <!-- Modal -->

{% comment %} script for modal {% endcomment %}
<script>
    // --------------------------------------------------------------------------------------------------
    // Function to show/hide radio buttons based on the balance value
    function toggleRadioButtons() {
        var balanceInput = document.querySelector('[name="balance"]');
        var radioButtonsContainer = document.querySelector('.radio-buttons');

        if (parseFloat(balanceInput.value) > 0) {
            radioButtonsContainer.style.display = 'block';
        } else {
            radioButtonsContainer.style.display = 'none';
        }
    }

    // Initial state on page load
    toggleRadioButtons();

    // Bind the function to the input's input event
    document.querySelector('[name="balance"]').addEventListener('input', toggleRadioButtons);


    // ------------------------------------------------------------------------------------------------------------


        function validateGSTIN() {
            // Get the input value
            var gstinInput = document.getElementById('gstinInput').value.trim();

            // Define the GSTIN pattern
            var gstinPattern = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[0-9]{1}Z[0-9]{1}$/;

            // Check if the input matches the pattern
            if (!gstinPattern.test(gstinInput)) {
                // Set a custom validation message
                document.getElementById('gstinInput').setCustomValidity('Please enter a valid GSTIN number.');
            } else {
                // Clear the custom validation message
                document.getElementById('gstinInput').setCustomValidity('');
            }
        }

// ------------------------------------------------------------------------------------------------------------
</script>

    
</div>
</div>
<div class="container col-md-10 mr-1" style="background-color: rgb(130, 144, 199);min-height: 100vh;">
    <br><br><br><br><br><br>
    <div class="col-11 container mr-1">
        <div class="row">
            <!-- party table -->
            <div class="col-11 table-responsive" style="background-color: white;padding: 30px;border-radius: 15px;box-shadow: 3px 3px 3px gray;">
                <div class="row">
                    <h3>Item </h3>
                    <div class="dropdown ml-2"></div>
                </div>
                <br>
                <div class="row">
                    <table class="table mt-3" id="dynamicadd">
                        <thead>
                            <tr>
                                <th>SL.No</th>
                                <th>Product</th>
                                <th>HSN</th>
                                <th>Qty</th>
                                <th>Price</th>
                                <th>Tax</th>
                                <th>Discount</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows will be dynamically added here -->
                        </tbody>
                    </table>
                    <button type='button' id='add' class='btn btn-success'>+</button>
                </div>
            </div>
        </div>
    </div><br>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type='text/javascript'>



        var modalCounter = 0;

        $(document).ready(function () {
            var i = 1;
        
            // Initial SL.No
            updateSerialNumbers();
        
            $('#add').click(function () {
                i++;
                var modalId = 'exampleModal' + modalCounter++;
                var newRow = '<tr id="row' + i + '">' +
                    '<td class="serial-no"></td>' +
                    '<td><div class="input-group">' +
                        
                        '<div class="product-dropdown"  style="height: 9vh;">'+ 
                            '<input type="text" class="dropdown-input form-control" id="item_id" placeholder="Select Item" onclick="getDetails();">'+
                            '<div class="dropdown-list" id="item">'+
                                '{% for i in item %}'+
                               
                                    '<div class="dropdown-item" data-value="{{ i.id }} data-hsn="{{i.item_hsn}}"">{{i.item_name}}</div>'+
                            
                                '{% endfor %}'+
                            '</div>'+
                        '</div>'+
                    '<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#' + modalId + '"><i class="fa-solid fa-plus"></i></button>' +
                    '</div></td>' +
                    '<td><input type="text" name="hsn[]" class="form-control" style="width:90px;"></td>' +
                    '<td><input type="number" name="qty[]" class="form-control" style="width:40px;"></td>' +
                    '<td><input type="text" name="price[]" class="form-control" style="width:50px;"></td>' +
                    '<td><input type="text" name="tax[]" class="form-control" style="width:80px;"></td>' +
                    '<td><input type="number" name="discount[]" class="form-control" style="width:70px;"></td>' +
                    '<td><input type="number" name="total[]" class="form-control" style="width:60px;"></td>' +
                    '<td><button type="button" id="btnRemove_' + i + '" class="btn btn-danger remove_row"><i class="fa-solid fa-square-minus"></i></button></td>' +
                    '</tr>';
        
                var modalHtml = '<div class="modal fade" id="' + modalId + '" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">' +
                    '<div class="modal-dialog" role="document">' +
                    '<div class="modal-content">' +
                    '<div class="modal-header">' +
                    '<h5 class="modal-title" id="exampleModalLabel">Add Item</h5>' +
                    '<button type="button" class="close" data-dismiss="modal" aria-label="Close">' +
                    '<span aria-hidden="true">&times;</span>' +
                    '</button>' +
                    '</div>' +
                    '<div class="modal-body">' +
                    '<form id="form_action" action="{% url "item_save" %}" method="post" enctype="multipart/form-data">' +
                    '{% csrf_token %}' +
        
                    '<div class="form-group row">' +
                    '<div class="col"><label id="itemname"> Item Name:</label><input id="input" type="text" name="itemname" class="form-control" placeholder="Item Name" required></div>' +
                    '<div class="col"><label id="hsn"> Item HSN:</label><input id="input" type="text" name="hsn" class="form-control" placeholder="Item HSN" required></div>' +
                    '<div class="col"><label id="unit"> Item Unit:</label><input id="input" type="text" name="unit" class="form-control" placeholder="Item Unit"></div>' +
        
                    '</div>' +
                    '<div class="form-group row">'+
                        '<div class="col"><label></label>Taxable<input id="" type="radio" name="taxable" style="color:black;"></div>'+
                        '<div class="col"><label></label>Non Taxable<input id="" type="radio" name="nontaxable"></div>'+
                        '<div class="col"><label id="saleprice"> Sale Price</label><input id="input" type="text" name="saleprice" class="form-control" placeholder="Sale Price"></div>'+
                        '<div class="col"><label id="purchaseprice">Purchase Price</label><input id="input" type="text" name="purchaseprice" class="form-control" placeholder="Purchase Price"></div>'+
                    '</div>'+
        
                    '<center>' +
                    '<button style="background-color: #3d4465;color: white;" onmouseover="this.style.backgroundColor=\'#480ceb\'" onmouseout="this.style.backgroundColor=\'#3d4465\'" class="btn " value="old" name="buttonn">Save </button> ' +
                    '</center>' +
        
                    '</form>' +
                    '</div>' +
                    '<div class="modal-footer">' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '</div>';
        
                $('#dynamicadd tbody').append(newRow);
                $('body').append(modalHtml);
        
                // Update SL.No after adding a new row
                updateSerialNumbers();

                // Initialize Select2 for the product dropdown
                initializeProductDropdown();
            });
        
            $(document).on('click', '.remove_row', function () {
                var row_id = $(this).attr("id").split('_')[1];
                $('#row' + row_id).remove();
        
                // Update SL.No after removing a row
                updateSerialNumbers();
            });
        
            function updateSerialNumbers() {
                $('.serial-no').text(function (index) {
                    return index + 1;
                });
            }

            function initializeProductDropdown() {
                $('.dropdown-input').on('focus', function () {
                    $('.dropdown-list').css('display', 'block');
                });
        
                $(document).on('mousedown', function (event) {
                    if (!$(event.target).closest('.product-dropdown')) {
                        $('.dropdown-list').css('display', 'none');
                    }
                });
        
                $('.dropdown-list').on('click', function (event) {
                    if ($(event.target).hasClass('dropdown-item')) {
                        $('.dropdown-input').val(event.target.textContent);
                        $('.dropdown-list').css('display', 'none');
                        fillEmployeeDetails();
                        clearErrorMessage();
                    }
                });
        
                $('.dropdown-input').on('input', function () {
                    var filterValue = $('.dropdown-input').val().toLowerCase();
                    var items = $('.dropdown-list .dropdown-item');
        
                    items.each(function () {
                        var itemText = $(this).text().toLowerCase();
                        $(this).css('display', itemText.includes(filterValue) ? 'block' : 'none');
                    });
                });
            }
        });
        {% comment %} document.addEventListener('DOMContentLoaded', function () {
            var input = document.querySelector('.dropdown-input');
            var dropdownList = document.querySelector('#item');
    
            input.addEventListener('focus', function () {
                dropdownList.style.display = 'block';
            });
    
            document.addEventListener('mousedown', function (event) {
                if (!event.target.closest('.product-dropdown')) {
                    dropdownList.style.display = 'none';
                }
            });
    
            dropdownList.addEventListener('click', function (event) {
                if (event.target.classList.contains('dropdown-item')) {
                    input.value = event.target.textContent;
                    dropdownList.style.display = 'none';
                    fillEmployeeDetails();
                    clearErrorMessage();
                }
            });
    
            input.addEventListener('input', function () {
                var filterValue = input.value.toLowerCase();
                var items = dropdownList.querySelectorAll('.dropdown-item');
    
                items.forEach(function (item) {
                    var itemText = item.textContent.toLowerCase();
                    if (itemText.includes(filterValue)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
         }); {% endcomment %}

        
    </script>
    
</div>
  <br>
    <div class="container col-md-6 mr-5" style="background-color: rgb(130, 144, 199);min-height: 100vh;">
        <form action="" class="col-10 container" method="post" enctype="multipart/form-data" style="background-color: #869deb; padding: 30px; border-radius: 15px;box-shadow: 4px 3px 4px gray; display: flex; flex-direction: column;">
    {% csrf_token %}
    <div class="form-group" style="display: flex; flex-direction: column; gap: 15px;">
        <div style="display: flex; flex-direction: row; align-items: center;"><label for="subtotal" >Sub Total</label><input id="subtotal" type="number" name="subtotal" class="form-control ml-auto" placeholder="" style="width:200px;"></div>
        <div style="display: flex; flex-direction: row; align-items: center;"><label for="gst">GST</label><input id="gst" type="text" name="gst" class="form-control ml-auto" placeholder="" style="width:200px;"></div>
        <div style="display: flex; flex-direction: row; align-items: center;"><label for="adjustment">Tax Amount</label><input id="adjustment" type="text" name="adjustment" class="form-control ml-auto" placeholder="" style="width:200px;"></div>
        <div style="display: flex; flex-direction: row; align-items: center;"><label for="grandtotal">Round Off</label><input id="roundoff" type="text" name="roundoff" class="form-control ml-auto" placeholder="" style="width:200px;"></div>
        <div style="display: flex; flex-direction: row; align-items: center;"><label for="paidoff">Grand Total</label><input id="grandtotal" type="text" name="grandtotal" class="form-control ml-auto" placeholder="" style="width:200px;"></div>
        <div style="display: flex; flex-direction: row; align-items: center;"><label for="balance">Description</label><input id="des" type="text" name="des" class="form-control ml-auto" placeholder="" style="width:200px;"></div>
    </div>
</form>
<br><br>
<div class="ml-auto">
    <center>
        <button style="background-color: #3d4465;color: white;" onmouseover="this.style.backgroundColor='#480ceb'" onmouseout="this.style.backgroundColor='#3d4465'" class="btn  " value="new" name="buttonn">Save & New</button> 
        <button style="background-color: #3d4465;color: white;" onmouseover="this.style.backgroundColor='#480ceb'" onmouseout="this.style.backgroundColor='#3d4465'" class="btn " value="old" name="buttonn"><a href="{% url "transactiontable" %}">Save</a> </button> 
    </center><br><br>
    </div>
    </div> 
    
</div>
<script>    

// ----------------------------------------------------------------------------------------------------

var modalCounter = 0; // Unique counter for modal IDs

function addRow() {
    var table = document.getElementById("itemTable").getElementsByTagName('tbody')[0];
    var newRow = table.insertRow(table.rows.length);
    var cells = [];

    for (var i = 0; i < 9; i++) {
        cells[i] = newRow.insertCell(i);
    }

    var modalId = 'exampleModal' + modalCounter++;

    cells[1].innerHTML = '<div class="input-group">' +
        '<input type="text" name="product[]" id="product" class="form-control" placeholder="Product">' +
        '<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#' + modalId + '"><i class="fa-solid fa-plus"></i></button>' +
        '</div>';

    // Add the modal outside of the input-group div
    var modalHtml = '<div class="modal fade" id="' + modalId + '" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">' +
        '<div class="modal-dialog" role="document">' +
        '<div class="modal-content">' +
        '<div class="modal-header">' +
        '<h5 class="modal-title" id="exampleModalLabel">Add Item</h5>' +
        '<button type="button" class="close" data-dismiss="modal" aria-label="Close">' +
        '<span aria-hidden="true">&times;</span>' +
        '</button>' +
        '</div>' +
        '<div class="modal-body">' +
            '<form id="form_action" action="" method="post" enctype="multipart/form-data">'+
                '{% csrf_token %}'+
        
                '<div class="form-group row">'+
                    '<div class="col"><label id="itemname"> Item name:</label><input id="input" type="text" name="itemname" class="form-control" placeholder="Item Name" required></div>'+
                    '<div class="col"><label id="hsn">Item HSN:</label><input id="input" type="text" name="hsn" class="form-control"  placeholder="Item HSN" required></div>'+
                    '<div class="col"><label id="unit"> Item Unit:</label><input id="input" type="text" name="unit" class="form-control" placeholder="Item Unit"></div>'+ 
                '</div>'+
                '<div class="form-group row">'+
                    '<div class="col"><label id="taxable">Taxable</label><input id="" type="radio" name="taxable" class="form-control"required></div>'+
                    '<div class="col"><label id="nontaxable">Non Taxable</label><input id="" type="radio" name="nontaxable" class="form-control"></div>'+ 
                '</div>'+
        
                    '<center>'+
                        '<button style="background-color: #3d4465;color: white;" onmouseover="this.style.backgroundColor=\'#480ceb\'" onmouseout="this.style.backgroundColor=\'#3d4465\'" class="btn " value="old" name="buttonn">Save </button> '+
                    '</center>'+
        
            '</form>' +
        '</div>' +
        '<div class="modal-footer">' +
        '<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>' +
        '<button type="button" class="btn btn-primary">Save changes</button>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '</div>';

    // Append the modal HTML to the document body
    document.body.insertAdjacentHTML('beforeend', modalHtml);

    // Add the rest of your code for other cells
    cells[2].innerHTML = '<input type="text" id="hsn" name="" style="width:90px;">';
    cells[3].innerHTML = '<input type="number" id="qty" name="" style="width:40px;">';
    cells[4].innerHTML = '<input type="text" name="" id="price" style="width:50px;">';
    cells[5].innerHTML = '<input type="text" name="" id="tax" style="width:80px;">';
    cells[6].innerHTML = '<input type="number" name="" id="discount" style="width:70px;">';
    cells[7].innerHTML = '<input type="number" name="" id="total" style="width:60px;">';
    cells[8].innerHTML = '<a href=""><i class="fa-solid fa-clone"></i></a><br>' +
        '<a href=""><i class="fa-solid fa-square-minus"></i></a>';
}




</script>


{% endblock %}